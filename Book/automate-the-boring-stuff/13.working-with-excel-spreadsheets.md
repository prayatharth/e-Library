13  Working With Excel Spreadsheets
===


Although we don’t often think of spreadsheets as programming tools, almost everyone uses them to organize information into two-dimensional data structures, perform calculations with formulas, and produce output as charts. In the next two chapters, we’ll integrate Python into two popular spreadsheet applications: Microsoft Excel and Google Sheets.

Excel is a popular and powerful spreadsheet application for Windows. The  openpyxl  module allows your Python programs to read and modify Excel spreadsheet files. For example, you might have the boring task of copying certain data from one spreadsheet and pasting it into another one. Or you might have to go through thousands of rows and pick out just a handful of them to make small edits based on some criteria. Or you might have to look through hundreds of spreadsheets of department budgets, searching for any that are in the red. These are exactly the sort of boring, mindless spreadsheet tasks that Python can do for you.

Although Excel is proprietary software from Microsoft, there are free alternatives that run on Windows, macOS, and Linux. Both LibreOffice Calc and OpenOffice Calc work with Excel’s  _.xlsx_  file format for spreadsheets, which means the  openpyxl  module can work on spreadsheets from these applications as well. You can download the software from  _[https://www.libreoffice.org/](https://www.libreoffice.org/)_  and  _[https://www.openoffice.org/](https://www.openoffice.org/)_, respectively. Even if you already have Excel installed on your computer, you may find these programs easier to use. The screenshots in this chapter, however, are all from Excel 2010 on Windows 10.

### **Excel Documents**

First, let’s go over some basic definitions: an Excel spreadsheet document is called a  _workbook_. A single workbook is saved in a file with the  _.xlsx_  extension. Each workbook can contain multiple  _sheets_  (also called  _worksheets_). The sheet the user is currently viewing (or last viewed before closing Excel) is called the  _active sheet_.

Each sheet has  _columns_  (addressed by letters starting at  _A_) and  _rows_  (addressed by numbers starting at 1). A box at a particular column and row is called a  _cell_. Each cell can contain a number or text value. The grid of cells with data makes up a sheet.

### **Installing the openpyxl Module**

Python does not come with OpenPyXL, so you’ll have to install it. Follow the instructions for installing third-party modules in  [Appendix A](https://automatetheboringstuff.com/2e/chapter13/#calibre_link-2); the name of the module is  openpyxl.

This book uses version 2.6.2 of OpenPyXL. It’s important that you install this version by running  pip install --user -U openpyxl==2.6.2  because newer versions of OpenPyXL are incompatible with the information in this book. To test whether it is installed correctly, enter the following into the interactive shell:
```py
import openpyxl
```
If the module was correctly installed, this should produce no error messages. Remember to import the  openpyxl  module before running the interactive shell examples in this chapter, or you’ll get a  NameError: name 'openpyxl' is not defined  error.

You can find the full documentation for OpenPyXL at  _[https://openpyxl.readthedocs.org/](https://openpyxl.readthedocs.org/)_.

### **Reading Excel Documents**

The examples in this chapter will use a spreadsheet named  _example.xlsx_  stored in the root folder. You can either create the spreadsheet yourself or download it from  _[https://nostarch.com/automatestuff2/](https://nostarch.com/automatestuff2/)_.  [Figure 13-1](https://automatetheboringstuff.com/2e/chapter13/#calibre_link-1575)  shows the tabs for the three default sheets named _Sheet1_, _Sheet2_, and _Sheet3_ that Excel automatically provides for new workbooks. (The number of default sheets created may vary between operating systems and spreadsheet programs.)

  ![enter image description here](https://automatetheboringstuff.com/2e/images/000024.jpg)
  _Figure 13-1: The tabs for a workbook’s sheets are in the lower-left corner of Excel._

Sheet 1 in the example file should look like  [Table 13-1](https://automatetheboringstuff.com/2e/chapter13/#calibre_link-1576). (If you didn’t download  _example.xlsx_  from the website, you should enter this data into the sheet yourself.)

**Table 13-1:**  The  _example.xlsx_  Spreadsheet

**A**

**B**

**C**

**1**

4/5/2015 1:34:02 PM

Apples

73

**2**

4/5/2015 3:41:23 AM

Cherries

85

**3**

4/6/2015 12:46:51 PM

Pears

14

**4**

4/8/2015 8:59:43 AM

Oranges

52

**5**

4/10/2015 2:07:00 AM

Apples

152

**6**

4/10/2015 6:10:37 PM

Bananas

23

**7**

4/10/2015 2:40:46 AM

Strawberries

98

Now that we have our example spreadsheet, let’s see how we can manipulate it with the  openpyxl  module.

#### **_Opening Excel Documents with OpenPyXL_**

Once you’ve imported the  openpyxl  module, you’ll be able to use the  openpyxl.load_workbook()  function. Enter the following into the interactive shell:

import openpyxl  
wb = openpyxl.load_workbook('example.xlsx')  
type(wb)  
<class 'openpyxl.workbook.workbook.Workbook'>

The  openpyxl.load_workbook()  function takes in the filename and returns a value of the  workbook  data type. This  Workbook  object represents the Excel file, a bit like how a  File  object represents an opened text file.

Remember that  _example.xlsx_  needs to be in the current working directory in order for you to work with it. You can find out what the current working directory is by importing  os  and using  os.getcwd(), and you can change the current working directory using  os.chdir().

> [Source : ](https://automatetheboringstuff.com/2e/chapter13/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE2MTA3NTg3MzEsMTI2NDQ2NDQyMF19
-->